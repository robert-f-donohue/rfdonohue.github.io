---
import SiteLayout from "../../layouts/SiteLayout.astro";
import ProjectCard from "../../components/ProjectCard.astro";
import { getCollection } from "astro:content";

const all = await getCollection("projects");

const startup = all.filter((p) => p.data.category === "startup");
const academic = all.filter((p) => p.data.category === "academic");

const sortKey = (a: any, b: any) => {
  const ad = a.data.pubDate?.valueOf?.() ?? 0;
  const bd = b.data.pubDate?.valueOf?.() ?? 0;
  if (ad !== bd) return bd - ad;
  return a.data.title.localeCompare(b.data.title);
};

startup.sort(sortKey);
academic.sort(sortKey);
---

<SiteLayout title="Projects" description="Academic + startup work, with writeups and results.">
  <header class="space-y-2">
    <h1 class="text-3xl font-bold tracking-tight">Projects</h1>
    <p class="text-muted">Startup work and research notes with clear outcomes and write-ups.</p>
  </header>

  <section class="mt-10">
    <div class="flex items-baseline justify-between">
      <h2 class="text-xl font-semibold">Startup</h2>
      <span class="text-sm text-muted">{startup.length} items</span>
    </div>
    <div class="mt-4 grid gap-4 md:grid-cols-2">
      {startup.map((p) => <ProjectCard project={p} />)}
    </div>
  </section>

  <section class="mt-12">
    <div class="flex items-baseline justify-between">
      <h2 class="text-xl font-semibold">Academic</h2>
      <span class="text-sm text-muted">{academic.length} items</span>
    </div>
    <div class="mt-4 grid gap-4 md:grid-cols-2">
      {academic.map((p) => <ProjectCard project={p} />)}
    </div>
  </section>
</SiteLayout>


