---
import { getCollection } from "astro:content";
import SiteLayout from "../../layouts/SiteLayout.astro";

const projects = await getCollection("projects");

// Sort: dated projects first; otherwise by title
const sorted = projects.sort((a, b) => {
  const ad = a.data.pubDate ? a.data.pubDate.getTime() : -Infinity;
  const bd = b.data.pubDate ? b.data.pubDate.getTime() : -Infinity;
  if (ad !== bd) return bd - ad;
  return a.data.title.localeCompare(b.data.title);
});
---

<SiteLayout title="Projects" description="Selected projects and research case studies.">
  <h1 class="text-3xl font-bold">Projects</h1>
  <p class="mt-2 text-base opacity-80">Selected work: product, research, and modeling case studies.</p>

  <ul class="mt-8 space-y-6">
    {sorted.map((p) => (
      <li class="rounded-xl border border-black/10 p-5 shadow-sm">
        <a class="text-xl font-semibold" href={`/projects/${p.slug}/`}>{p.data.title}</a>
        <p class="mt-2">{p.data.description}</p>

        <div class="mt-3 text-sm opacity-80">
          <strong>Status:</strong> {p.data.status}
          {p.data.website ? <>{" · "}<a href={p.data.website} target="_blank">Website</a></> : null}
          {p.data.writeup ? <>{" · "}<a href={p.data.writeup} target="_blank">Write-up</a></> : null}
          {p.data.demo ? <>{" · "}<a href={p.data.demo} target="_blank">Demo</a></> : null}
          {p.data.paper ? <>{" · "}<a href={p.data.paper} target="_blank">Paper</a></> : null}
          {p.data.slides ? <>{" · "}<a href={p.data.slides} target="_blank">Slides</a></> : null}
        </div>
      </li>
    ))}
  </ul>
</SiteLayout>
