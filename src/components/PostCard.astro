---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import Card from "./Card.astro";
import FormattedDate from "./FormattedDate.astro";
import Tag from "./Tag.astro";

const { post, featured = false } = Astro.props as {
  post: CollectionEntry<"blog">;
  featured?: boolean;
};

const words =
  typeof (post as any).body === "string"
    ? ((post as any).body as string).trim().split(/\s+/).filter(Boolean).length
    : 0;

const minutes = words ? Math.max(1, Math.round(words / 200)) : 0;
const readingTime = minutes ? `${minutes} min read` : null;

const projectHref = post.data.projectSlug ? `/projects/${post.data.projectSlug}/` : null;
---

<Card href={`/blog/${post.slug}/`} ariaLabel={`Read: ${post.data.title}`}>
  {post.data.heroImage ? (
    <div class="mb-3 overflow-hidden rounded-xl bg-panel/40 shadow-soft/20">
      <Image
        src={post.data.heroImage}
        alt=""
        width={1200}
        height={630}
        class={`w-full object-cover ${featured ? "h-56" : "h-40"}`}
      />
    </div>
  ) : null}

  <div class="space-y-2">
    <div class="flex flex-wrap items-center gap-x-2 gap-y-1 text-xs text-muted">
      <span><FormattedDate date={post.data.pubDate} /></span>
      {readingTime ? <span aria-hidden="true">·</span> : null}
      {readingTime ? <span>{readingTime}</span> : null}

      {projectHref ? <span aria-hidden="true">·</span> : null}
      {projectHref ? (
        <a
          href={projectHref}
          class="pointer-events-auto relative z-30 rounded-full border border-border bg-panel/60 px-2 py-0.5 text-xs text-fg hover:bg-panel"
        >
          Related project →
        </a>
      ) : null}
    </div>

    <h3 class={`font-semibold text-fg leading-snug ${featured ? "text-2xl" : "text-lg"}`}>
      {post.data.title}
    </h3>

    <p class="text-sm text-muted">{post.data.description}</p>

    {post.data.tags?.length ? (
      <div class="pt-1 flex flex-wrap gap-2">
        {post.data.tags.slice(0, featured ? 6 : 4).map((t: string) => <Tag label={t} />)}
      </div>
    ) : null}
  </div>
</Card>

